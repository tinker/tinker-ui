#!/usr/bin/env node

var fs = require('fs'),
	path = require('path'),
	sass = require('node-sass'),
	wrup = require('wrapup')();

var args = process.argv.splice(1);
if (!args[1] || !fs.statSync(args[1]).isDirectory()) {
	console.log('Please specify a directory to put the built files');
	process.exit(1);
}

console.log('Building required files...');

var src = path.normalize(__dirname + '/../src'),
	dest = path.resolve(args[1]);

// javascript
wrup
	.require('tinker', src + '/js/tinker.js')
	.options({globalize: 'window'})
	.up(function(err, js){
		if (err){
			console.log(' - Failed to compile JavaScript');
			console.log(err);
			return;
		}
		fs.writeFile(dest + '/tinker.app.js', js, function(err){
			if (err){
				console.log(' - Failed to write file');
				console.log(err);
			} else {
				console.log(' - JS compiled to ' + dest + '/tinker.app.js');
			}
		});
	});

// stylesheets
sass.render({
	file: src + '/css/app.scss',
	success: function(css){
		fs.writeFile(dest + '/tinker.app.css', css, function(err){
			if (err){
				console.log(' - Failed to write file');
				console.log(err);
			} else {
				console.log(' - CSS compiled to ' + dest + '/tinker.app.css');
			}
		});
	},
	error: function(err){
		console.log(' - Failed to compile CSS');
		console.log(err);
	}
});
